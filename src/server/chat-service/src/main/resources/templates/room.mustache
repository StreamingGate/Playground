{{>header}}
<body>
<div>
    <h3>채팅방 리스트</h3>
    <div>
        <label>방제목</label>
        <input id="roomName" type="text"/>
        <button type="button" onClick="createRoom()">채팅방 개설</button>
    </div>
    <ul>
        {{#rooms}}
        <li>
            <button type="button" onClick="enterRoom(`{{roomId}}`)"> {{name}} </button>
        </li>
        {{/rooms}}
    </ul>
</div>
</body>
{{>footer}}
<!-- JavaScript -->

<script>
    
    let chatRooms = [];
    
    //findAllRoom = () => {
     //   axios.get('/chat/rooms').then(response => { chatRooms = response.data.rooms; });
    //}
    createRoom = () => {
        const roomName = document.querySelector("#roomName").value;
        console.log(roomName);
        if("" === roomName) {
            alert("방 제목을 입력해 주십시요.");
            return;
        } else {
            let params = new URLSearchParams();
            params.append("name", roomName);
            console.log(params)
            axios.post('/chat/room', params)
            .then(
                response => {
                    console.log('---',response.data);
                    //alert(response.data.name+"방 개설에 성공하였습니다.")
                    
                    document.querySelector("#roomName").innerText ='';
                    
                    window.location.href="/chat/room";
                }
            )
            .catch( response => {
                console.log(response);
                alert("채팅방 개설에 실패하였습니다.");
                //window.location.href="/chat/room"; 
            });
        }
    };
    enterRoom= (roomId) => {
        console.log("enterRoom btn");
        const sender = prompt('대화명을 입력해 주세요.');
        localStorage.setItem('wschat.sender',sender);
        localStorage.setItem('wschat.roomId',roomId);
        location.href="/chat/room/enter/"+roomId;
    };
    //findAllRoom();
</script>